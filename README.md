## Zed Nav Package
### Set up

#### Software Set up
1. Make sure Zed SDK 4.5.2 or earlier is installed.
2. Set up zed-ros2-wrapper using the guide: https://github.com/stereolabs/zed-ros2-wrapper
3. Put this package "zed_nav" into the src folder. 
4. Run following:
```
sudo apt install ros-humble-slam-toolbox ros-humble-pointcloud-to-laserscan ros-humble-tf2-sensor-msgs
```


<b>Note</b>: if it is zed-sdk code has already been set up. Just check before redownloading everything. 

<b>Note</b>: The LiDAR point cloud will no longer be in the 'velodyne' frame, it will now be in 'odom'.


#### Hardware Set up
1. Ubuntu 22.04 + Humble Laptop
2. Zed 2i Camera
### To Use

#### How to start the code
```
# Launch Camera
ros2 launch zed_wrapper zed_camera.launch.py camera_model:=zed2i

# Launch Node
ros2 run zed_nav camera_commander
```
#### Subscribe to Command
- If you echo /nav_command topic it will (hopefully) tell the robot what to do. If you have any questions about Zed Camera Ask Matt. 
```
ros2 topic echo /nav_command 

data: back
---
data: forward
---
data: forward
---
data: forward

```
#### Visualize 2D Cost Map
1. Start up the Rivz2
```
rviz2
```
2. Press Add, select "Pose", set topic to "/zed/zed_nose/pose"
    - This is what the camera thinks we are at. 
3. Press Add, select "Map", set topic to "local_costmap"
    - This is a 2D compression 
### Code Structure
- To make modifications to the Grid Map and main ros2 files: /zed_nav/camera_commander.py
- To make modifications to the Lane Detection files: /zed_nav/lanedetection
### Todo 
- [x] Set up ZED 2i camera
- [x] Launch ZED ROS 2 node
- [x] Visualize 2D cost Map
- [x] Add Better Lane Detection to the obstacle detection
- [ ] TD1: Callibrate the Lane Detection
- [ ] TD2: Filter out the point cloud generated by Zed Cam.
- [ ] TD3: Convert the "/nav_command" into teleop twist. 

#### TD1: Callibrate the Lane Detection:
- I do not have time to callibrate the lane detection algorithm, Software team should have the callibrated parameters add them into /zed_nav/camera_commander.py
```python
self.declare_parameters(
            '',
            [
                ("focal_x",      2300), ("focal_y",      2930),
                ("opt_center_x", 640),  ("opt_center_y", 360),
                ("cam_height",   2500), ("pitch", 0.0), ("yaw", 0.0), ("roll", 0.0),
                ("ipm_left", 125), ("ipm_right", 1155), ("ipm_top", 650), ("ipm_bottom", 720),
                ("lane_h_low", 0), ("lane_s_low", 0), ("lane_v_low", 200),
                ("lane_h_high", 255), ("lane_s_high", 50), ("lane_v_high", 255),
            ]
        )
```
- You will also need to check if my transformation is correct check "update_lane_cache".

#### TD2: Filter out the point cloud generated by Zed Cam:
- Add Size Filter. (e.g. No obstacle smaller than 10 grids )
- Add Approximity Filter (e.g. No obstacle within 50cm of the camera, camera cannot sense it)

#### TD3 Convert the "/nav_command" into teleop twist:
- This thing can be down using Chat GPT.